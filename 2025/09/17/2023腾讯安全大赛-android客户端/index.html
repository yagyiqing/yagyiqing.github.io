<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yagyiqing","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="最终目的：编写注册机，实现输入任意token，都可计算出激活外挂的码 GitHub - yagyiqing&#x2F;-storehouse: 收集项目源码 环境：1.pixel3，arm64 2.win11 工具： ida 9.2&#x2F;7.7  jadx -1.5.3  il2cppDumper  GAMBA-main  010editor  jeb5.1   一个好的工具可以简化很多工作">
<meta property="og:type" content="article">
<meta property="og:title" content="2023腾讯安全大赛-android客户端">
<meta property="og:url" content="https://yagyiqing/yagyiqing.github.io/2025/09/17/2023%E8%85%BE%E8%AE%AF%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-android%E5%AE%A2%E6%88%B7%E7%AB%AF/index.html">
<meta property="og:site_name" content="行走云端">
<meta property="og:description" content="最终目的：编写注册机，实现输入任意token，都可计算出激活外挂的码 GitHub - yagyiqing&#x2F;-storehouse: 收集项目源码 环境：1.pixel3，arm64 2.win11 工具： ida 9.2&#x2F;7.7  jadx -1.5.3  il2cppDumper  GAMBA-main  010editor  jeb5.1   一个好的工具可以简化很多工作">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119090117822.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119090417478.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119093147754.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119093634945.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119094818961.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119095041277.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119095206839.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119100103518.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119114154961.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119101336389.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115327356.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115501061.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115543517.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115650721.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115725412.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119105041035.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115926148.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115954415.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119120137940.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119120223766.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119105714190.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119120320030.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119122055299.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120121445300.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120121547050.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120121959503.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120122134714.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170402953.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170443832.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170542763.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170735518.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120171808665.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120172940411.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120172443999.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120172504397.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120173202980.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120173332043.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120174020410.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120174200992.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120174324049.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175350518.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201162056974.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175408988.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175509241.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175624484.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201110643626.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201110735428.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201110904720.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201155552989.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201161205829.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201162041883.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201163811214.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201163832090.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201163846769.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201164410541.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201165351218.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201165923140.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201173306590.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201174008430.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201174507489.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201174812690.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201175108211.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201175442466.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201175633748.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201180202339.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101338367.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101650480.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101750751.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101850613.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202102456799.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202103101853.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202103538149.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202103832200.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202111205338.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202145624848.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202145742721.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202145947557.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202150436821.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202150455796.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202151134650.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202151421016.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202152037447.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202152319783.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202152546122.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251118180851776.png">
<meta property="article:published_time" content="2025-09-17T11:26:58.000Z">
<meta property="article:modified_time" content="2025-12-02T07:59:00.533Z">
<meta property="article:author" content="行走云端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119090117822.png">

<link rel="canonical" href="https://yagyiqing/yagyiqing.github.io/2025/09/17/2023%E8%85%BE%E8%AE%AF%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-android%E5%AE%A2%E6%88%B7%E7%AB%AF/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>2023腾讯安全大赛-android客户端 | 行走云端</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">行走云端</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-all">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>all</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yagyiqing/yagyiqing.github.io/2025/09/17/2023%E8%85%BE%E8%AE%AF%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-android%E5%AE%A2%E6%88%B7%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="行走云端">
      <meta itemprop="description" content="学无止境">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="行走云端">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2023腾讯安全大赛-android客户端
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-17 19:26:58" itemprop="dateCreated datePublished" datetime="2025-09-17T19:26:58+08:00">2025-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-12-02 15:59:00" itemprop="dateModified" datetime="2025-12-02T15:59:00+08:00">2025-12-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">Android逆向</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>最终目的：编写注册机，实现输入任意token，都可计算出激活外挂的码</p>
<p><a target="_blank" rel="noopener" href="https://github.com/yagyiqing/-storehouse">GitHub - yagyiqing&#x2F;-storehouse: 收集项目源码</a></p>
<h1 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h1><p>1.pixel3，arm64</p>
<p>2.win11</p>
<h1 id="工具："><a href="#工具：" class="headerlink" title="工具："></a>工具：</h1><ol>
<li><p>ida 9.2&#x2F;7.7</p>
</li>
<li><p>jadx -1.5.3</p>
</li>
<li><p>il2cppDumper</p>
</li>
<li><p>GAMBA-main</p>
</li>
<li><p>010editor</p>
</li>
<li><p>jeb5.1</p>
</li>
</ol>
<p>一个好的工具可以简化很多工作量</p>
<h1 id="开始逆思路"><a href="#开始逆思路" class="headerlink" title="开始逆思路:"></a>开始逆思路:</h1><p>拿到 apk文件后，push到手机端，在电脑端解压并打开lib文件夹找切入点</p>
<p>解压后的文件夹中观察到有 libil2cpp.so 文件，这是 unity 游戏使用 IL2CPP 编译方式很明显的标志，游戏的核心算法几乎都在lib2cpp.so文件中</p>
<p>使用IL2CPP（所有 C# 源代码 → IL → C++ → 编译成 lib2cpp.so）的unity游戏一般还伴随着 global-metadata.dat 元数据文件（一般在：assets\bin\Data\Managed\Metadata），元数据文件中包含方法名，类名，字段名等信息，但它是二进制文件不能直接打开</p>
<p>所以先借助 <a target="_blank" rel="noopener" href="https://blog.csdn.net/gitblog_00264/article/details/151529330">il2cppDumper</a> 工具 提取出想要的信息</p>
<p>原始的 c# 代码已经不在游戏里了，IL2CppDumper 做的就是 从libil2cpp.so中把类型，字段，方法名，方法参数等提取出来，再组合成一个dump.cs文件</p>
<p>使用方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">完整参数格式</span><br><span class="line">Il2CppDumper.exe &lt;executable-file&gt; &lt;global-metadata&gt; &lt;output-directory&gt;&gt;</span><br><span class="line"></span><br><span class="line">Il2CppDumper libil2cpp.so global-metadata.dat ./output</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119090117822.png"></p>
<p>发现失败了，打开 global-metadata.dat 文件，发现并没有被加密</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119090417478.png" title="" alt="" width="535">

<p>那就是 libil2cpp.so文件被加密</p>
<h2 id="dump-解密状态的-libil2cpp-so-文件"><a href="#dump-解密状态的-libil2cpp-so-文件" class="headerlink" title="dump 解密状态的 libil2cpp.so 文件"></a>dump 解密状态的 libil2cpp.so 文件</h2><p>so 文件在运行的时候肯定是解密的状态，所以使用 frida 动态 dump 内存中的 so 文件</p>
<p>但是直接注入frida 会提示 hack detect ，然后就退出了</p>
<p>应该是有 frida 检测</p>
<p>去一下 frida 的特征</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">修改frida-server的名称</span><br><span class="line">rm frida-server fs</span><br><span class="line">修改端口: </span><br><span class="line">./fs -l 0.0.0.0:1234</span><br><span class="line">-l: listen 0.0.0.0：监听所有网络接口</span><br><span class="line"></span><br><span class="line">端口转发：</span><br><span class="line">adb forward tcp:1234 tcp:1234</span><br><span class="line">在PC上访问 127.0.0.1：1234 会被转发到Android设备上的127.0.0.1：1234</span><br><span class="line"></span><br><span class="line">脚本注入：</span><br><span class="line">frida -H 127.0.0.1:1234 -l test1.js -F</span><br><span class="line">-H 指定远程（或本地）frida-server 的地址/端口</span><br></pre></td></tr></table></figure>

<p>再注入就不会提示 hack detect 了</p>
<p>dump脚本如下：</p>
<p>把进程内存中已加载的 .so 模块整段读取出来，然以写到文件中，dump 出来</p>
<p>在 Android 应用里有一个顶层对象 是 Application：它代表整个应用程序的全局状态，系统启动应用时，会先创建一个Application 实例，然后再创建具体的 Activity, Service等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">function dump_so(so_name)&#123;</span><br><span class="line"></span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line"></span><br><span class="line">        // 拿到当前应用程序的Application对象</span><br><span class="line"></span><br><span class="line">        var currentApplication = Java.use(&quot;android.app.ActivityThread&quot;).currentApplication();</span><br><span class="line"></span><br><span class="line">        if(currentApplication ==null)&#123;</span><br><span class="line"></span><br><span class="line">            console.log(&quot;Application还没有初始化成功，请稍等...&quot;)</span><br><span class="line"></span><br><span class="line">            setTimeout(tryAgain,1000);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        else&#123;</span><br><span class="line"></span><br><span class="line">            var dir = currentApplication.getApplicationContext().getFilesDir().getPath();&#125;</span><br><span class="line"></span><br><span class="line">        // 拿到全局Context，获取文件路径</span><br><span class="line"></span><br><span class="line">        function tryAgain()&#123;</span><br><span class="line"></span><br><span class="line">            var currentApplication2 = Java.use(&quot;android.app.ActivityThread&quot;).currentApplication();</span><br><span class="line"></span><br><span class="line">            if(currentApplication2 ==null)&#123;</span><br><span class="line"></span><br><span class="line">            console.log(&quot;Application还没有初始化成功，请稍等...&quot;)</span><br><span class="line"></span><br><span class="line">            setTimeout(tryAgain,1000);</span><br><span class="line"></span><br><span class="line">        &#125; else&#123;var dir = currentApplication2.getApplicationContext().getFilesDir().getPath();&#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 获取指定模块信息</span><br><span class="line"></span><br><span class="line">        var libso = Process.getModuleByName(so_name);</span><br><span class="line"></span><br><span class="line">        console.log(&quot;[name]:&quot;, libso.name);</span><br><span class="line"></span><br><span class="line">        console.log(&quot;[base]:&quot;, libso.base);</span><br><span class="line"></span><br><span class="line">        console.log(&quot;[size]:&quot;, ptr(libso.size));</span><br><span class="line"></span><br><span class="line">        console.log(&quot;[path]:&quot;, libso.path);</span><br><span class="line"></span><br><span class="line">        var file_path = dir + &quot;/&quot; + libso.name + &quot;_&quot; + libso.base + &quot;_&quot; + ptr(libso.size) + &quot;.so&quot;;</span><br><span class="line"></span><br><span class="line">        var  file_handle = new File(file_path, &quot;wb&quot;);</span><br><span class="line"></span><br><span class="line">        if(file_handle &amp;&amp; file_handle != null)&#123;</span><br><span class="line"></span><br><span class="line">            // 修改指定内存区域的保护属性</span><br><span class="line"></span><br><span class="line">            Memory.protect(ptr(libso.base), libso.size, &#x27;rwx&#x27;);</span><br><span class="line"></span><br><span class="line">            // 读取字节数组</span><br><span class="line"></span><br><span class="line">            var libso_buffer = ptr(libso.base).readByteArray(libso.size);  </span><br><span class="line"></span><br><span class="line">            file_handle.write(libso_buffer);</span><br><span class="line"></span><br><span class="line">            file_handle.flush();</span><br><span class="line"></span><br><span class="line">            file_handle.close();</span><br><span class="line"></span><br><span class="line">            console.log(&quot;[dump]:&quot;, file_path);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dump_so(&quot;libil2cpp.so&quot;);</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119093147754.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119093634945.png"></p>
<p>直接移动提示没有权限，所以直接复制到 &#x2F;data&#x2F;local&#x2F;tmp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /data/user/0/com.com.sec2023.rocketmouse.mouse/files/libil2cpp.so_0x6fdae91000_0x13cc000.so /data/local/tmp</span><br><span class="line">chmod 777 libil2cpp.so_0x6fdae91000_0x13cc000.so</span><br><span class="line">adb pull /data/local/tmp/libil2cpp.so_0x6fdae91000_0x13cc000.so &quot;C:\Users\y2467\Desktop\&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119094818961.png"></p>
<p>再使用 il2cppDumper 工具</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119095041277.png"></p>
<p>成功！</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119095206839.png"></p>
<h2 id="修复-dump-下来的-so-文件"><a href="#修复-dump-下来的-so-文件" class="headerlink" title="修复 dump 下来的 so 文件"></a>修复 dump 下来的 so 文件</h2><p>对于dump下来的so文件，所有段和节的偏移都是在运行内存中的偏移，dump 下来的只是一个平铺的内存镜像，对于静态分析来说不是一个合法的 elf 文件，所以需要修复  Segment 偏移和大小 &#x2F; Section 头的偏移 &#x2F; Section的内容和名称 &#x2F; Section的偏移和大小，以便ELF 文件分析器 （ida）可以找到相关的段和节</p>
<h3 id="修正段（Segment）的偏移："><a href="#修正段（Segment）的偏移：" class="headerlink" title="修正段（Segment）的偏移："></a>修正段（Segment）的偏移：</h3><p>段的位置和大小由程序头表中的这四个元素决定</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119100103518.png"></p>
<p>故需要将 program_header 中每一个元素的 </p>
<p>p_vaddr_VIRTUAL_ADDRESS  复制给 p_offset_FROM_FILE_BEGIN</p>
<p>p_memsz_SEGMENT_RAM_LENGTH 复制给 p_filesz_SEGMENT_FILE_LENGTH</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119114154961.png"></p>
<h3 id="修正-节表头的偏移"><a href="#修正-节表头的偏移" class="headerlink" title="修正 节表头的偏移:"></a>修正 节表头的偏移:</h3><p>节表头的位置在最后一个段（segment）之后</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119101336389.png" title="" alt="" width="468">

<p>ELF头中的Elf64_Off e_shoff_SECTION_HEADER_OFFSET_IN_FILE字段表示 Section Header 在文件中的偏移</p>
<p>修改前是：0x11AB778</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115327356.png"></p>
<p>要修改成在运行内存中的偏移，计算过程如下:</p>
<p>Program_Header 中的最后一个元素的 </p>
<p>偏移 + 文件大小 &#x3D; p_vaddr_VIRTUAL_ADDRESS + p_memsz_SEGMENT_RAM_LENGTH &#x3D;0x00000000013BC000 + 0xF778 &#x3D; 0x13CB778</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115501061.png"></p>
<h3 id="补充Section-头的内容："><a href="#补充Section-头的内容：" class="headerlink" title="补充Section 头的内容："></a>补充Section 头的内容：</h3><p>因为Android 的Linker 在加载so文件时只需要 Program Header ，不会加载 Section 头的内容，所以dump下来的so中section头是空的</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115543517.png" title="" alt="" width="501">

<p>从libil2cpp.so 中复制 节的内容到dump下来的so 中，复制后需要按下F5重新运行一下 模板 ELF.bt</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115650721.png" title="" alt="" width="497">

<h3 id="恢复节的名称："><a href="#恢复节的名称：" class="headerlink" title="恢复节的名称："></a>恢复节的名称：</h3><p>修补内容后，Section的名称还是乱码</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115725412.png" title="" alt="" width="490">

<p>ELF 文件中每个Section 都是有名字的，比如 .data .text等，每个名字都是一个字符串，既然是字符串就需要一个字符串池来保存，而这个字符串池也是一个Section(保存了其他Section以及它自己的名字)，这个特殊的Section 叫做 .shatrtab  </p>
<p>所有section的头部是连续放在一块的，类似于一个数组，Elf64_Half e_shtrndx_STRING_TABLE_INDEX 变量就是 节（.shatrtab） 在这个数组中的下标</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119105041035.png" title="" alt="" width="414">

<p>定位到struct section_table_entry64_t section_table_element[26] 中的 Elf64_Off s_offset </p>
<p>Elf64_Offs_offset的值决定了 section 的名称将从哪里去索引</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115926148.png" title="" alt="" width="425">

<p>右击该数值，点击转到，会发现是乱码</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119115954415.png" title="" alt="" width="484">

<p>回到dump前的so,同样转到这个位置，发现是明文，直接复制过去，F5更新</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119120137940.png" title="" alt="" width="459">

<p>段的名称正确显示</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119120223766.png" title="" alt="" width="423">

<h3 id="修正节的偏移"><a href="#修正节的偏移" class="headerlink" title="修正节的偏移"></a>修正节的偏移</h3><p>节的位置和大小由节头表中的两个字段决定</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119105714190.png"></p>
<p>所以如果 s_addr &#x3D; 0，无需修改s_offset</p>
<p>如果s_addr ≠ 0，将s_addr 的值复制给 s_offset</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119120320030.png" title="" alt="" width="431">

<p>将修复好的 libil2cpp.so_0x6fdae91000_0x13cc000.so 拖入IDA</p>
<p>分析完如下图：</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251119122055299.png" title="" alt="" width="425">

<p>之后,点击 File-&gt;Script file… 运行 il2cppdumper 中的 ida_with_struct_py3.py ,选择 script.json，选择 il2cpp.h</p>
<p>等待分析完成…第一次运行等待的时间会久一点</p>
<h2 id="根据-coin-找切入点"><a href="#根据-coin-找切入点" class="headerlink" title="根据 coin 找切入点"></a>根据 coin 找切入点</h2><p>unity 使用的不是原生的 UI，所以setOnClickListener监听不到按钮</p>
<p>随便翻翻 dump.cs 文件，搜索 coin 字符串,可以看到 有CollentCoin方法，转去ida中搜索一下，果然搜到了</p>
<img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120121445300.png" title="" alt="" width="402">

<p>切换到 汇编试图</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120121547050.png"></p>
<p>很明显，是获取flag的逻辑判断</p>
<p>使用frida patch一下，将1000换成0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function flag()&#123;</span><br><span class="line"> var moudle = Process.getModuleByName(&quot;libil2cpp.so&quot;);</span><br><span class="line"> //IDA定位数值偏移地址:右击数据 -&gt; 同步到IDA View-A</span><br><span class="line"> var cmp = moudle.base.add(0x4653CC) </span><br><span class="line">console.log(&quot;patch--&quot;);</span><br><span class="line"> Memory.protect(cmp,4,&quot;rwx&quot;);</span><br><span class="line"> cmp.writeByteArray([0x1F,0x00,0x00,0x71])</span><br><span class="line">&#125;</span><br><span class="line">flag();</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120121959503.png"></p>
<p>随便吃几个金币，就可以获取flag</p>
<p>再回到 dump.cs 文件随外下翻翻，看到有一个 SamllKeyboard.KeyboardType枚举类</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120122134714.png"></p>
<p>不同的操作数对应不同的变量</p>
<p>转到ida中搜索一下SamllKeyboard</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170402953.png"></p>
<p>点开函数看看，注意到 SmallKeyboard__oO0oOo0 ，真是此地无银三百两</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170443832.png"></p>
<p>SmallKeyboard__oO0oOo0 中有随机数生成函数 并且 循环8次</p>
<p>小键盘处token的长度也是8，并且每次打开的数值不同</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170542763.png"></p>
<p>SmallKeyboard__iI1Ii 中，如果keyType &#x3D;&#x3D; 2就执行 包含生成随机数的一系列函数</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120170735518.png"></p>
<p>猜测 System_Convert__ToUInt64_8763844 为用户输入函数，使用frida 验证一下猜想</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function hook_input()&#123;</span><br><span class="line">    var module = Process.getModuleByName(&quot;libil2cpp.so&quot;)</span><br><span class="line">    var addr = module.base.add(0x85B9C4)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(addr,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line">            console.log(&quot;返回值是：&quot;,retval.toInt32())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hook_input()</span><br></pre></td></tr></table></figure>

<p>在小键盘处输入 123123</p>
<p>frida 注入 frida -H 127.0.0.1:1234 -l input.js -F</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120171808665.png"></p>
<p>很明显，验证了猜想</p>
<p>每次按下 ok 键后，token 都会更新，正好对应了此处SmallKeyboard__oO0oOo0(v8, v18) 函数的调用</p>
<p>v16 作为参数传入了  SmallKeyboard__iI1Ii_4610736 函数，所以这个函数就是要找的加密点，转到汇编窗口，点进去SmallKeyboard__iI1Ii_4610736 经过两个B （无条件跳转），转到了</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120172940411.png"></p>
<p>ARM64 不允许用一条指令直接取64位地址，所以一般用ADRP+LDR的组合获取全局变量地址</p>
<p>点进去0ff_13BAFF0</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120172443999.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120172504397.png"></p>
<p>跳到了导入函数 g_sec2023_p_array 处，表示要找的加密点应该在libsec2023.so文件的导出函数g_sec2023_p_array 的 0x48偏移处</p>
<p>直接将 &#x2F;lib 文件夹下的 libsec2023.so 拖入ida中分析，找到导出函数，点进去</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120173202980.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120173332043.png"></p>
<p>sub_31164 就是跳转处</p>
<h2 id="去除花指令，找到第一个加密点"><a href="#去除花指令，找到第一个加密点" class="headerlink" title="去除花指令，找到第一个加密点"></a>去除花指令，找到第一个加密点</h2><p>接下来就是分析 sub_31164 函数</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120174020410.png"></p>
<p>看到有两个加密函数 sub_3B8CC 和 v5</p>
<p>先分析 sub_3B8CC </p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120174200992.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120174324049.png"></p>
<p>但是遇到了控制流阻塞 ，ida 静态分析时无法动态的获取寄存器的值，所以无法展示正常的控制流</p>
<p>以sub_3B9D4() 函数为例 转到汇编窗口看看 </p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175350518.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201162056974.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175408988.png"></p>
<p>计算一下跳转的地址</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175509241.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251120175624484.png"></p>
<p>手动修复一个控制流，把不需要的汇编代码都nop掉，ida9.2破解版好像缺失 arm64的汇编器插件，太新了，先用ida7.7打开</p>
<p>每个条件码的含义</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201110643626.png"></p>
<p>修复后如下图：</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201110735428.png"></p>
<p>再u，c，p,重新F5</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201110904720.png"></p>
<p>阻塞就消失了，变为我们修改的逻辑</p>
<p>so 文件中使用该结构的太多了，所以选择使用半手工半脚本的方式修复</p>
<p>手工修复之前，使用frida stalker先追踪一下每个寄存器值的变化，可以减轻一些工作量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">function anti_BR()&#123;</span><br><span class="line">    // 因为ida反汇编出的内容遇到 BR X8的阻塞，所以现在使用frida stalker追踪一下x8寄存器</span><br><span class="line">    var module = Process.getModuleByName(&quot;libsec2023.so&quot;)</span><br><span class="line">    var func_addr = module.base.add(0x31164) </span><br><span class="line">    console.log(&quot;[hook]:&quot;,func_addr)</span><br><span class="line">    Interceptor.attach(func_addr,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            console.log(&quot;start stalker!&quot;)</span><br><span class="line">            this.tid = Process.getCurrentThreadId()</span><br><span class="line">            Stalker.exclude(&#123;</span><br><span class="line">                &quot;base&quot;:Process.getModuleByName(&quot;libc.so&quot;).base,</span><br><span class="line">                &quot;size&quot;:Process.getModuleByName(&quot;libc.so&quot;).size</span><br><span class="line">            &#125;</span><br><span class="line">            )</span><br><span class="line">            Stalker.follow(this.tid,&#123;</span><br><span class="line">                events:&#123;</span><br><span class="line">                    call: true, // CALL instructions: yes please</span><br><span class="line">                    // Other events:</span><br><span class="line">                    ret: false, // RET instructions</span><br><span class="line">                    exec: false, // all instructions: not recommended as it&#x27;s</span><br><span class="line">                    //a lot of data</span><br><span class="line">                    block: false, // block executed: coarse execution trace</span><br><span class="line">                    compile: false // block compiled: useful for coverage</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line">                transform(iterator)&#123;</span><br><span class="line">                    let instruction = iterator.next();</span><br><span class="line">                    const startAddress = instruction.address;</span><br><span class="line">                    // 判断该条指令是否在代码库中</span><br><span class="line">                    const isAppCode = startAddress.compare(module.base) &gt;= 0 &amp;&amp;startAddress.compare(module.base.add(module.size)) &lt;= 0;</span><br><span class="line">                    do&#123;</span><br><span class="line">                        if(isAppCode)&#123;</span><br><span class="line">                            if(instruction.mnemonic === &quot;br&quot;)&#123;</span><br><span class="line">                                // 保存指令的操作数字符串，比如 br x8 ，reg_name保存的便是寄存器的名称</span><br><span class="line">                                var reg_name = instruction.opStr;</span><br><span class="line">                                var inst_addr = new NativePointer(instruction.address);</span><br><span class="line">                                iterator.putCallout(function(context)&#123;</span><br><span class="line">                                    // 地址显示是：undefined</span><br><span class="line">                                     //console.log(Process.getModuleByAddress(inst_addr).base)</span><br><span class="line">                                     var addr_before = inst_addr.sub(Process.findModuleByAddress(inst_addr).base).toString()</span><br><span class="line">                                     //console.log(addr_before)</span><br><span class="line">                                     //这是br x8 跳转后的地址</span><br><span class="line">                                     //console.log(Process.findModuleByAddress(ptr(context[reg_name])).base)</span><br><span class="line">                                     var addr_after = ptr(context[reg_name]).sub(Process.findModuleByAddress(ptr(context[reg_name])).base).toString()</span><br><span class="line">                                     //console.log(addr_after)</span><br><span class="line">                                     if(addr_after == undefined)&#123;</span><br><span class="line">                                        addr_after = &quot;unknown:&quot;+ context[reg_name]</span><br><span class="line">                                     &#125;</span><br><span class="line">                                     console.log(addr_before,&quot;jump to:&quot;,addr_after,&quot;:&quot;,reg_name)</span><br><span class="line">                                &#125;);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        iterator.keep();</span><br><span class="line">                    &#125; while ((instruction = iterator.next()) !== null);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            console.log(&quot;stalker end!&quot;);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line">            Stalker.unfollow(this.tid);</span><br><span class="line">            Stalker.garbageCollect();</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">anti_BR()</span><br></pre></td></tr></table></figure>

<p>代码注入时，提示 hack ,但是是提顿一会再提示的，猜测这个延迟是sleep,故尝试hook 一下sleep,把 sleep 的时间传入一个指针随便指向什么地方，让sleep一直运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function AntiDebug()&#123;</span><br><span class="line">    var addr = Module.findExportByName(null,&quot;sleep&quot;);</span><br><span class="line">    if(!addr)&#123;</span><br><span class="line">         console.log(&quot;sleep 没有找到&quot;)</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">         Interceptor.attach(addr,&#123;</span><br><span class="line">            onEnter(args)&#123;</span><br><span class="line">              console.log(&quot;success&quot;)</span><br><span class="line">              console.log(&quot;原始sleep时间是：&quot;,args[0])</span><br><span class="line">              console.log(&quot;sleep called from:\n&quot;+Thread.backtrace(this.context,Backtracer.ACCURATE)</span><br><span class="line">              .map(DebugSymbol.fromAddress).join(&#x27;\n&#x27;) )</span><br><span class="line">              args[0] = ptr(100000)</span><br><span class="line">            &#125;,</span><br><span class="line">            onLeave(retval)&#123;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">AntiDebug()</span><br></pre></td></tr></table></figure>

<p>再注入 stalker ，就不再退出</p>
<p>stalker追踪的结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br></pre></td><td class="code"><pre><span class="line">stalker end!</span><br><span class="line">0x3ba00 jump to: 0x3ba04 : x10</span><br><span class="line">0x3ba30 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba74 : x12</span><br><span class="line">0x3badc jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bb2c : x13</span><br><span class="line">0x3bb4c jump to: 0x3ba04 : x10</span><br><span class="line">0x3ba30 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba34 : x12</span><br><span class="line">0x3ba70 jump to: 0x3ba74 : x12</span><br><span class="line">0x3badc jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bae0 : x13</span><br><span class="line">0x3bb28 jump to: 0x3bb2c : x13</span><br><span class="line">0x3bb4c jump to: 0x3bb50 : x10</span><br><span class="line">0x3a08c jump to: 0x3a0f0 : x8</span><br><span class="line">0x3b508 jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b550 : x11</span><br><span class="line">0x3b5c0 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b608 : x11</span><br><span class="line">0x3aa70 jump to: 0x3aa74 : x8</span><br><span class="line">0x3aaa0 jump to: 0x3aaa4 : x8</span><br><span class="line">0x3aad4 jump to: 0x3aad8 : x8</span><br><span class="line">0x3ab04 jump to: 0x3ab70 : x8</span><br><span class="line">0xf28c jump to: 0x82c40 : x17</span><br><span class="line">0xf4ac jump to: 0x83100 : x17</span><br><span class="line">0x3ac90 jump to: 0x3acc0 : x11</span><br><span class="line">0xf40c jump to: 0x1db30 : x17</span><br><span class="line">0xf28c jump to: 0x82c40 : x17</span><br><span class="line">0xf4ac jump to: 0x83100 : x17</span><br><span class="line">0x3b950 jump to: 0x3b95c : x8</span><br><span class="line">0x3a08c jump to: 0x3a0f0 : x8</span><br><span class="line">0x3b508 jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b50c : x11</span><br><span class="line">0x3b54c jump to: 0x3b550 : x11</span><br><span class="line">0x3b5c0 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b5c4 : x11</span><br><span class="line">0x3b604 jump to: 0x3b608 : x11</span><br><span class="line">0x3aa70 jump to: 0x3aa74 : x8</span><br><span class="line">0x3aaa0 jump to: 0x3aaa4 : x8</span><br><span class="line">0x3aad4 jump to: 0x3aad8 : x8</span><br><span class="line">0x3ab04 jump to: 0x3ab70 : x8</span><br><span class="line">0xf28c jump to: 0x82c40 : x17</span><br><span class="line">0xf4ac jump to: 0x83100 : x17</span><br><span class="line">0x3ac90 jump to: 0x3acc0 : x11</span><br><span class="line">0xf40c jump to: 0x1db30 : x17</span><br><span class="line">0xf28c jump to: 0x82c40 : x17</span><br><span class="line">0xf4ac jump to: 0x83100 : x17</span><br><span class="line">0x3b990 jump to: 0x3b99c : x8</span><br><span class="line">0x311a0 jump to: 0x13b8d64 : x2</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br><span class="line">0xf3fc jump to: 0x1c924 : x17</span><br></pre></td></tr></table></figure>

<p>由追踪到的结果可知，br 跳转指令，要么跳到紧接着的下一个指令处，要么跳转到另一个函数处</p>
<p>去除CSEL 指令的脚本如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">import ida_bytes</span><br><span class="line">import ida_ida</span><br><span class="line">import ida_segment</span><br><span class="line">import idc</span><br><span class="line">import idautils</span><br><span class="line">import idaapi</span><br><span class="line">from keystone import *</span><br><span class="line"></span><br><span class="line">def patch_nop(begin, end):  # arm64中的NOP指令是b&#x27;\x1F\x20\x03\xD5&#x27;</span><br><span class="line">    while end &gt; begin:</span><br><span class="line">        ida_bytes.patch_bytes(begin, b&#x27;\x1F\x20\x03\xD5&#x27;)</span><br><span class="line">        begin = begin + 4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#获取text段的起始地址</span><br><span class="line">text_seg=ida_segment.get_segm_by_name(&quot;.text&quot;)</span><br><span class="line">start=text_seg.start_ea</span><br><span class="line">end=text_seg.end_ea</span><br><span class="line">cur_addr=start</span><br><span class="line">#在结构修复完之后需要nop的指令地址</span><br><span class="line">nop_addr_after_finsh=[]</span><br><span class="line">while cur_addr&lt;end:</span><br><span class="line">    #找到CSEL指令</span><br><span class="line">    if idc.print_insn_mnem(cur_addr)==&quot;CSEL&quot;:</span><br><span class="line">        csel_addr=cur_addr</span><br><span class="line">        nop_addr_after_finsh_tmp=[]</span><br><span class="line">        nop_addr_after_finsh_tmp.append(csel_addr)</span><br><span class="line">        BR_reg=&quot;&quot;</span><br><span class="line">        BR_addr=0</span><br><span class="line">        tmp_addr=idc.next_head(csel_addr)</span><br><span class="line">        #向下寻找BR指令</span><br><span class="line">        for i in range(9):</span><br><span class="line">            if idc.print_insn_mnem(tmp_addr)==&quot;BR&quot;:</span><br><span class="line">                BR_addr=tmp_addr</span><br><span class="line">                BR_reg=idc.print_operand(tmp_addr,0)</span><br><span class="line">                break</span><br><span class="line">            if idc.print_insn_mnem(tmp_addr)==&quot;CSEL&quot;:</span><br><span class="line">                break</span><br><span class="line">            tmp_addr=idc.next_head(tmp_addr)</span><br><span class="line">        #找到了BR指令</span><br><span class="line">        if BR_addr!=0:</span><br><span class="line">            #获取CSEL的op1~3寄存器,以及条件码</span><br><span class="line">            CSEL_opt1=idc.print_operand(csel_addr,0)</span><br><span class="line">            CSEL_opt2=idc.print_operand(csel_addr,1)</span><br><span class="line">            CSEL_opt2_val=-1</span><br><span class="line">            CSEL_opt3=idc.print_operand(csel_addr,2)</span><br><span class="line">            CSEL_opt3_val=-1</span><br><span class="line">            CSEL_cond=idc.print_operand(csel_addr,3)</span><br><span class="line">            tmp_addr=idc.prev_addr(csel_addr)</span><br><span class="line">            while (CSEL_opt2_val==-1 or CSEL_opt3_val==-1) and tmp_addr &gt;start:</span><br><span class="line">                #读取条件分支语句CSEL要赋值给目标寄存器的两个源寄存器中的值</span><br><span class="line">                #XZR代表0</span><br><span class="line">                if CSEL_opt2==&quot;XZR&quot;:</span><br><span class="line">                    CSEL_opt2_val=0</span><br><span class="line">                if CSEL_opt3==&quot;XZR&quot;:</span><br><span class="line">                    CSEL_opt3_val=0</span><br><span class="line">                if idc.print_insn_mnem(tmp_addr)==&quot;MOV&quot;:</span><br><span class="line">                    #这里切片是因为x19和W19是一样的寄存器，用[1::]可以只取到后面的19</span><br><span class="line">                    if idc.print_operand(tmp_addr,0)[1::]==CSEL_opt2[1::] and CSEL_opt2_val==-1:</span><br><span class="line">                        CSEL_opt2_val=idc.get_operand_value(tmp_addr,1)</span><br><span class="line">                        nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                    if idc.print_operand(tmp_addr, 0)[1::] == CSEL_opt3[1::] and CSEL_opt3_val == -1:</span><br><span class="line">                        CSEL_opt3_val = idc.get_operand_value(tmp_addr, 1)</span><br><span class="line">                        nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                tmp_addr=idc.prev_head(tmp_addr)</span><br><span class="line">            assert CSEL_opt3_val!=-1 and CSEL_opt2_val!=-1</span><br><span class="line">            #print(f&quot;偏移是&#123;CSEL_opt2_val&#125;,&#123;CSEL_opt3_val&#125;&quot;)</span><br><span class="line">            #现在开始取跳转表所在的位置，加到跳转的值</span><br><span class="line">            tmp_addr=BR_addr</span><br><span class="line">            jump_array_reg=&quot;&quot;#储存跳转表所在的寄存器</span><br><span class="line">            jump_array_addr=-1#存储跳转表所在的地址</span><br><span class="line">            add_reg=[]#存储加到跳转表的值的寄存器</span><br><span class="line">            add_val=-1#加到跳转表的值</span><br><span class="line">            #从BR后往前找,到CSEL_结束，存储跳转表等修复数据</span><br><span class="line">            while tmp_addr&gt;csel_addr:</span><br><span class="line">                if idc.print_insn_mnem(tmp_addr)==&quot;ADD&quot; and idc.print_operand(tmp_addr,0)==BR_reg:</span><br><span class="line">                    add_reg.append(idc.print_operand(tmp_addr,1)[1::])</span><br><span class="line">                    add_reg.append(idc.print_operand(tmp_addr,2)[1::])</span><br><span class="line">                    nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line"></span><br><span class="line">                elif idc.print_insn_mnem(tmp_addr)==&quot;MOV&quot; and idc.print_operand(tmp_addr,0)[1::] in add_reg:</span><br><span class="line">                    add_val=idc.get_operand_value(tmp_addr,1)</span><br><span class="line">                    nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                elif idc.print_insn_mnem(tmp_addr)==&quot;LDR&quot;:</span><br><span class="line">                    #获取存储跳转表地址的寄存器名称，后面是那个寄存器加载的不重要</span><br><span class="line">                    jump_array_reg=idc.print_operand(tmp_addr,1)[1:-1].split(&quot;,&quot;)[0]#切片去除[],以，为标记分割，取第一个寄存器</span><br><span class="line">                    nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                elif idc.print_insn_mnem(tmp_addr)==&quot;ADRL&quot; :</span><br><span class="line">                    jump_array_reg=idc.print_operand(tmp_addr,0)</span><br><span class="line">                    jump_array_addr=idc.get_operand_value(tmp_addr,1)</span><br><span class="line">                    nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                elif idc.print_insn_mnem(tmp_addr)==&quot;SXTW&quot;:</span><br><span class="line">                    if idc.print_operand(tmp_addr,0)[1::] in add_reg:</span><br><span class="line">                        reg=idc.print_operand(tmp_addr,1)[1::]</span><br><span class="line">                        while tmp_addr&gt;start:</span><br><span class="line">                            if idc.print_insn_mnem(tmp_addr)==&quot;MOV&quot; and idc.print_operand(tmp_addr,1)[1::]==reg:</span><br><span class="line">                                add_val=idc.get_operand_value(tmp_addr,1)</span><br><span class="line">                                nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                                break</span><br><span class="line">                            tmp_addr=idc.prev_head(tmp_addr)</span><br><span class="line"></span><br><span class="line">                tmp_addr=idc.prev_head(tmp_addr)</span><br><span class="line"></span><br><span class="line">            #如果在CSEL_BR中间没有跳转表地址，就向上找</span><br><span class="line">            if jump_array_addr==-1:</span><br><span class="line">                tmp_addr=idc.prev_head(tmp_addr)</span><br><span class="line">                while tmp_addr&gt;start:</span><br><span class="line">                    if idc.print_insn_mnem(tmp_addr)==&quot;ADRL&quot;:</span><br><span class="line">                        if idc.print_operand(tmp_addr,0)==jump_array_reg:</span><br><span class="line">                            jump_array_addr = idc.get_operand_value(tmp_addr, 1)</span><br><span class="line">                            nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                            break</span><br><span class="line">                    elif idc.print_insn_mnem(tmp_addr)==&quot;ADRP&quot;:</span><br><span class="line">                        if idc.print_operand(tmp_addr,0)==jump_array_reg:</span><br><span class="line">                            jump_array_addr = idc.get_operand_value(tmp_addr, 1)</span><br><span class="line">                            nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                            #观察到ADPR还有一部分ADD</span><br><span class="line">                            while tmp_addr&lt;end:</span><br><span class="line">                                if idc.print_insn_mnem(tmp_addr)==&quot;ADD&quot;:</span><br><span class="line">                                    if idc.print_operand(tmp_addr,0)==jump_array_reg:</span><br><span class="line">                                        jump_array_addr+=idc.get_operand_value(tmp_addr,2)</span><br><span class="line">                                        nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                                        break</span><br><span class="line">                                tmp_addr=idc.next_head(tmp_addr)</span><br><span class="line">                            break</span><br><span class="line">                    tmp_addr=idc.prev_head(tmp_addr)</span><br><span class="line"></span><br><span class="line">            #如果没有找到加在跳转表的值</span><br><span class="line">            if add_val==-1:</span><br><span class="line">                tmp_addr=tmp_addr</span><br><span class="line">                while tmp_addr&gt;start:</span><br><span class="line">                    if idc.print_insn_mnem(tmp_addr)==&quot;MOV&quot;:</span><br><span class="line">                        if idc.print_operand(tmp_addr,0)[1::] in add_reg:</span><br><span class="line">                            add_val=idc.get_operand_value(tmp_addr,1)</span><br><span class="line">                            nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                            break</span><br><span class="line">                    elif idc.print_insn_mnem(tmp_addr)==&quot;SXTW&quot;:</span><br><span class="line">                        if idc.print_operand(tmp_addr,0)[1::] in add_reg:</span><br><span class="line">                            reg=idc.print_operand(tmp_addr,1)[1::]</span><br><span class="line">                            while tmp_addr&gt;start:</span><br><span class="line">                                if idc.print_insn_mnem(tmp_addr)==&quot;MOV&quot; and idc.print_operand(tmp_addr,1)[1::]==reg:</span><br><span class="line">                                    add_val=idc.get_operand_value(tmp_addr,1)</span><br><span class="line">                                    nop_addr_after_finsh_tmp.append(tmp_addr)</span><br><span class="line">                                    break</span><br><span class="line">                                tmp_addr=idc.prev_head(tmp_addr)</span><br><span class="line">                            break</span><br><span class="line">                    tmp_addr=idc.prev_head(tmp_addr)</span><br><span class="line">            &#x27;&#x27;&#x27;</span><br><span class="line">            print(f&quot;加到跳转表的值&#123;hex(add_val)&#125;&quot;)</span><br><span class="line">            print(f&quot;加到跳转表的值&#123;hex(add_val)&#125;&quot;)</span><br><span class="line">            print(add_reg)</span><br><span class="line">            print(f&quot;寄存表的值&#123;hex(ida_bytes.get_qword(jump_array_addr+CSEL_opt2_val)+add_val)&#125;&quot;)</span><br><span class="line">            print(f&quot;寄存表的值&#123;hex(ida_bytes.get_qword(jump_array_addr+CSEL_opt3_val)+add_val)&#125;&quot;)</span><br><span class="line">            &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">            #计算两个分支的位置</span><br><span class="line">            branch_a=(ida_bytes.get_qword(jump_array_addr+CSEL_opt2_val)+add_val)&amp; 0xffffffffffffffff</span><br><span class="line">            branch_b=(ida_bytes.get_qword(jump_array_addr+CSEL_opt3_val)+add_val)&amp; 0xffffffffffffffff</span><br><span class="line">            logic_rev = &#123;&quot;GE&quot;: &quot;LT&quot;, &quot;LT&quot;: &quot;GE&quot;, &quot;EQ&quot;: &quot;NE&quot;, &quot;NE&quot;: &quot;EQ&quot;, &quot;CC&quot;: &quot;CS&quot;, &quot;CS&quot;: &quot;CC&quot;, &quot;HI&quot;: &quot;LS&quot;, &quot;LS&quot;: &quot;HI&quot;&#125;</span><br><span class="line">            ks = Ks(KS_ARCH_ARM64, KS_MODE_LITTLE_ENDIAN)</span><br><span class="line">            code = &quot;&quot;</span><br><span class="line">            if branch_b == idc.next_head(BR_addr):  # 判断逻辑不取反</span><br><span class="line">                code = f&quot;B.&#123;CSEL_cond&#125; #&#123;hex(branch_a)&#125;&quot;</span><br><span class="line">            elif branch_a == idc.next_head(BR_addr):  # 判断逻辑取反</span><br><span class="line">                code = f&quot;B.&#123;logic_rev[CSEL_cond]&#125; #&#123;hex(branch_b)&#125;&quot;</span><br><span class="line">            #修复BR</span><br><span class="line">            if code!=&quot;&quot;:</span><br><span class="line">                patch_br_byte,cout=ks.asm(code,addr=BR_addr)</span><br><span class="line">                ida_bytes.patch_bytes(BR_addr,bytes(patch_br_byte))</span><br><span class="line">                print(f&quot;fix CSEL_RB at &#123;hex(BR_addr)&#125;&quot;)</span><br><span class="line">                nop_addr_after_finsh.extend(nop_addr_after_finsh_tmp)</span><br><span class="line">                cur_addr=idc.next_addr(BR_addr)</span><br><span class="line">            else:</span><br><span class="line">                print(f&quot;error! unable to fix CSEL-BR at &#123;hex(cur_addr)&#125;,branch:&#123;hex(branch_a)&#125;, &#123;hex(branch_b)&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    cur_addr=idc.next_head(cur_addr)</span><br><span class="line"></span><br><span class="line">for addr in nop_addr_after_finsh:</span><br><span class="line">    patch_nop(addr,addr+idc.get_item_size(addr))</span><br></pre></td></tr></table></figure>

<p>控制流都清晰了，捋一下sub_3B9D4()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">if(x8 &gt;=2)&#123;</span><br><span class="line">  sub_3BB50()</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)&amp;a5 + v5 + 4) = (*(_DWORD *)(a1 + 4 * a3) &gt;&gt; v6) ^ v5;</span><br><span class="line">    --v5;</span><br><span class="line">    v6 -= 8;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v5 &gt;= 0 );</span><br><span class="line">  HIBYTE(a5) ^= 0x86u;</span><br><span class="line">  BYTE6(a5) -= 94;</span><br><span class="line">  BYTE5(a5) ^= 0xD3u;</span><br><span class="line">  BYTE4(a5) -= 28;</span><br><span class="line">  *(_DWORD *)(a1 + 4 * a3) = 0;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = *((_BYTE *)&amp;a5 + v6 + 4) - v7;</span><br><span class="line">    *((_BYTE *)&amp;a5 + v6-- + 4) = v8;</span><br><span class="line">    v5 += v8 &lt;&lt; v7;</span><br><span class="line">    *(_DWORD *)(a1 + 4 * a3) = v5;</span><br><span class="line">    v7 -= 8;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v6 &gt;= 0 );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">然后进入循环</span><br></pre></td></tr></table></figure>

<p>加密过程比较清晰了：去除数据的每一位进行加密</p>
<p>hook一下 sub_3B9D4()，看输入的值和返回的值</p>
<p>hex(999999999999) &#x3D; 0xE8D4A50FFF</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201155552989.png"></p>
<p>加密后：0x 6d94cacc 3939d5e3 ,小端存储：最低有效位在低地址</p>
<p>编写解密脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 用户输入：999999999999，返回值是：0x6d94cacc3939d5e3</span><br><span class="line">algorithm_1=&#123;</span><br><span class="line">    (0,&quot;enc&quot;) :lambda x: (x-28) &amp; 0xff,  # 防止溢出或负数, 确保结果在 0~255 之间</span><br><span class="line">    (1,&quot;enc&quot;) :lambda x: (x^0xD3), </span><br><span class="line">    (2,&quot;enc&quot;) :lambda x: (x-94) &amp; 0xff,</span><br><span class="line">    (3,&quot;enc&quot;) :lambda x: (x^0x86),</span><br><span class="line"></span><br><span class="line">    (0,&quot;dec&quot;) :lambda x: (x+28)  &amp; 0xff,</span><br><span class="line">    (1,&quot;dec&quot;) :lambda x: (x^0xD3),</span><br><span class="line">    (2,&quot;dec&quot;) :lambda x: (x+94) &amp; 0xff,</span><br><span class="line">    (3,&quot;dec&quot;) :lambda x: (x^0x86)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#加密</span><br><span class="line">def enc_1(input):</span><br><span class="line">    input_bytes = bytearray(input.to_bytes(8,&#x27;little&#x27;))</span><br><span class="line">    enc_array = [0] * len(input_bytes)</span><br><span class="line">    for i in range(len(input_bytes)):</span><br><span class="line">        index = i % 4</span><br><span class="line">        enc_array[i] = (algorithm_1[(index,&quot;enc&quot;)](input_bytes[i]^ index) - 8*index ) &amp; 0xff</span><br><span class="line">    return int.from_bytes(bytearray(enc_array),&#x27;little&#x27;)</span><br><span class="line"></span><br><span class="line">#解密</span><br><span class="line">def dec_1(input):</span><br><span class="line">    input_bytes = bytearray(input.to_bytes(8,&#x27;little&#x27;))</span><br><span class="line">    dec_array = [0] * len(input_bytes)</span><br><span class="line">    for i in range(len(input_bytes)):</span><br><span class="line">        index = i % 4</span><br><span class="line">        dec_array[i] = (algorithm_1[(index,&quot;dec&quot;)]((input_bytes[i] + 8*index)&amp;0xff) ^ index) </span><br><span class="line">    return int.from_bytes(bytearray(dec_array),&#x27;little&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">    test_value = 999999999999</span><br><span class="line">    enc_value = enc_1(test_value)</span><br><span class="line">    dec_value = dec_1(enc_value)</span><br><span class="line">    print(f&quot;Test Value: &#123;test_value&#125;&quot;)</span><br><span class="line">    print(f&quot;Encrypted Value: &#123;hex(enc_value)&#125;&quot;)</span><br><span class="line">    print(f&quot;Decrypted Value: &#123;dec_value&#125;&quot;)</span><br><span class="line">    assert test_value == dec_value, &quot;Decryption did not return the original value!&quot;</span><br><span class="line"></span><br><span class="line">test()    </span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201161205829.png"></p>
<p>第一个加密点搞定</p>
<h2 id="第二个加密点"><a href="#第二个加密点" class="headerlink" title="第二个加密点"></a>第二个加密点</h2><p>回到 sub_3B8CC(),继续往下分析，发现CSET结构，结合stalker追踪到的值修复一下控制流,在修改过控制流函数的任意处，按下u,c,p，再F5就可显示出逻辑</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201162041883.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201163811214.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201163832090.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201163846769.png"></p>
<p>整理一下sub_3B8CC(),逻辑如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">unsigned __int64 __fastcall sub_3B8CC(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; // x0</span><br><span class="line">  unsigned int v4[3]; // [xsp+8h] [xbp-48h] BYREF</span><br><span class="line">  unsigned int v5; // [xsp+14h] [xbp-3Ch] BYREF</span><br><span class="line">  __int64 v6; // [xsp+18h] [xbp-38h]</span><br><span class="line"></span><br><span class="line">  v6 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(3, 3, 13, 0, 2)) + 40);</span><br><span class="line">  v4[0] = HIDWORD(a1);</span><br><span class="line">  v4[1] = a1;</span><br><span class="line">  sub_3B9D4((__int64)v4, a2);     ;第一个加密处</span><br><span class="line">  v4[2] = 0;</span><br><span class="line">  v5 = bswap32(v4[0]);            ;大小端转换</span><br><span class="line">  sub_3A054();</span><br><span class="line">  if ( (unsigned int)sub_3A924(v2, (__int64)&amp;v5, 4u) )   ;第二个加密点，先加密高位</span><br><span class="line">    return sub_3B954();</span><br><span class="line">  else</span><br><span class="line">    HIDWORD(a11) = bswap32(HIDWORD(a10));</span><br><span class="line">    sub_3A054();</span><br><span class="line">    v12 = sub_3A924(v11, (__int64)&amp;a11 + 4, 4u);   ;第二个加密点，再加密低位</span><br><span class="line">    if ( v15 != v16 )</span><br><span class="line">      return sub_3B994(v12, v13, v14);</span><br><span class="line">    else</span><br><span class="line">      return  v0 | ((unsigned __int64)v2 &lt;&lt; 32);    ;高位和低位交换位置</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook一下 sub_3A924，在ida中追踪下来，返回值是布尔值，所以该加密函数将加密的结果存放在了参数指针指向的缓冲区中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// sub_3A924  查看其参数和加密缓冲区的内容</span><br><span class="line">// 很多 C/C++ 的加密函数并不返回加密结果，而是把结果写到参数传进来的内存地址里（比如 args[3]）。</span><br><span class="line">// 函数的返回值只返回了符号象征，0或1</span><br><span class="line">var count = 0;</span><br><span class="line">var outbuffer_addr = [0,0]</span><br><span class="line">function sub_3A924()&#123;</span><br><span class="line">    var module = Process.getModuleByName(&quot;libsec2023.so&quot;)</span><br><span class="line">    var func_addr = module.base.add(0x3A924)</span><br><span class="line">    // 当这个函数执行时，就执行我们写的回调函数</span><br><span class="line">    Interceptor.attach(func_addr,&#123;</span><br><span class="line">        //函数被调用的瞬间执行</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            console.log(&quot;before first enc&quot;,count+1)</span><br><span class="line">            //这个参数可能是加密输出的缓冲区</span><br><span class="line">            outbuffer_addr[count] = args[3]</span><br><span class="line">            console.log(hexdump(args[1],&#123;</span><br><span class="line">                offset: 0,</span><br><span class="line">                length: 64,</span><br><span class="line">                header: true,</span><br><span class="line">                ansi: true</span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;,</span><br><span class="line">        //函数执行完毕，返回前执行</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line">            console.log(&quot;before first enc&quot;,count+1)</span><br><span class="line">            console.log(hexdump(outbuffer_addr[count],&#123;</span><br><span class="line">                offset: 0,</span><br><span class="line">                length: 64,</span><br><span class="line">                header: true,</span><br><span class="line">                ansi: true</span><br><span class="line">            &#125;));</span><br><span class="line">            count += 1;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">sub_3A924()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201164410541.png"></p>
<p>第一个加密点的返回值是：0x 6d94cacc 3939d5e3</p>
<p>此处的两个加密参数正好对应两次 bswap32</p>
<p>第二次加密后得到的值为：0x10d817aa 368ec0f4</p>
<p>进入 sub_3A924 分析：</p>
<p>发现有很多 v7 + 1408LL  v7 + 1664LL …. v7+offset的 ____fastcall 函数调用，v7一般就是 JNIEnv* 类型的指针了，但是ida分析时不知道它是什么类型的，所以默认为普通的指针</p>
<p><a target="_blank" rel="noopener" href="https://share.note.youdao.com/s/3YQsnaey">理解JNIEnv</a></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201165351218.png"></p>
<p>手动修改一下</p>
<p>选中变量v7 -&gt;按下快捷Y -&gt; 手动修改为JNIEnv*类型 - &gt; IDA就会将 V7 识别为一个 JNI环境指针</p>
<p>更改后如下：</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201165923140.png"></p>
<p>注意到有jni 函数 GetStaticMethodID（获取JAVA类中实例方法的id，以便native层可以调用该实例方法），hook一下，看调用了什么函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//hook GetStaticMethodID</span><br><span class="line">function Hook_GetStaticMethodID()&#123;</span><br><span class="line">    var symbols = Module.enumerateSymbolsSync(&quot;libart.so&quot;)</span><br><span class="line">    // console.log(&quot;hook:&quot;,symbols)</span><br><span class="line">    for(var i =0 ;i&lt;symbols.length;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        var symbol = symbols[i];</span><br><span class="line">        if(symbol.name.indexOf(&quot;GetStaticMethodID&quot;) != -1)</span><br><span class="line">        &#123;</span><br><span class="line">            console.log(&quot;name：&quot;,symbol.name)</span><br><span class="line">            console.log(&quot;hook&quot;,symbol.address)</span><br><span class="line">            Interceptor.attach(symbol.address,&#123;</span><br><span class="line">                onEnter(args)&#123;</span><br><span class="line">                    console.log(&quot;name:&quot;,args[2].readCString())</span><br><span class="line">                    console.log(&quot;sig:&quot;,args[3].readCString())</span><br><span class="line">                &#125;,</span><br><span class="line">                onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Hook_GetStaticMethodID();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201173306590.png"></p>
<p>调用了 java 方法：encrypt</p>
<p>转去 jadx 中搜索，没有结果，应该是dex动态加载的，故使用<a target="_blank" rel="noopener" href="https://github.com/hluwa/frida-dexdump">frida-dexdump</a> 把内存中dex dump下来</p>
<p>dump下来后，把dex拖入jadx中反编译，搜索 encrypt</p>
<p>加了 BlackObfuscator 混淆，直接拖入 <a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-278473.htm">jeb5.1</a>直接去混淆，使控制流平坦化</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201174008430.png"></p>
<p>这样看逻辑就相当清晰了，写脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line">#大端序和小端序</span><br><span class="line">#看变量的类型，整数和字节数组</span><br><span class="line"> </span><br><span class="line">print(hex(int.from_bytes(0xccca946d.to_bytes(4, &#x27;little&#x27;),&#x27;big&#x27;)))</span><br><span class="line"></span><br><span class="line">def enc_2(input):</span><br><span class="line">    # input_high = input =  0xccca946d</span><br><span class="line">    # input_low = input = 0xe3d53939</span><br><span class="line">    # 按照大端进行加密</span><br><span class="line">    input = int.from_bytes(input.to_bytes(4, &#x27;little&#x27;), &#x27;big&#x27;)  # 字节再次翻转</span><br><span class="line">    input = (input &gt;&gt; 7 | input &lt;&lt; 25) &amp; 0xffffffff</span><br><span class="line">    # 变成一个可操作的字节序列</span><br><span class="line">    input_byte = bytearray(input.to_bytes(4, &#x27;big&#x27;))</span><br><span class="line">    xor_arr = [50, -51, -1, -104, 25, -78, 0x7C, -102]</span><br><span class="line">    for i in range(4):</span><br><span class="line">        input_byte[i] = (input_byte[i] ^ xor_arr[i]) &amp; 0xff</span><br><span class="line">        input_byte[i] = (input_byte[i] + i) &amp; 0xff</span><br><span class="line">    return int.from_bytes(input_byte, &#x27;big&#x27;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def dec_2(input):</span><br><span class="line">    input_byte = bytearray(input.to_bytes(4, &#x27;big&#x27;))</span><br><span class="line">    xor_arr = [50, -51, -1, -104, 25, -78, 0x7C, -102]</span><br><span class="line">    for i in range(4):</span><br><span class="line">        input_byte[i] = (input_byte[i] - i) &amp; 0xff</span><br><span class="line">        input_byte[i] = (input_byte[i] ^ xor_arr[i]) &amp; 0xff</span><br><span class="line"> </span><br><span class="line">    input = int.from_bytes(input_byte, &#x27;big&#x27;)</span><br><span class="line">    input = (input &lt;&lt; 7 | input &gt;&gt; 25) &amp; 0xffffffff</span><br><span class="line">    input = int.from_bytes(input.to_bytes(4, &#x27;little&#x27;), &#x27;big&#x27;)  # 字节再次翻转</span><br><span class="line"> </span><br><span class="line">    return input</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def mytest_2():</span><br><span class="line">    # # 0x6d94cacc 3939d5e3,进入encrypt之前大小端转换了一次</span><br><span class="line">    # 把字节流解释成一个64位整数，按照小端的规则拼接</span><br><span class="line">    # 先加密高32位逆序字节，再加密低32位逆序字节</span><br><span class="line">    </span><br><span class="line">    # struct.pack(fmt, v1, v2, …)	把数字打包成字节流</span><br><span class="line">    # struct.unpack(fmt, bytes)	    把字节流打包成数字</span><br><span class="line">    data = b&#x27;\x6d\x94\xca\xcc\x39\x39\xd5\xe3&#x27;</span><br><span class="line">    input_high,input_low = struct.unpack(&#x27;&lt;2I&#x27;,data)</span><br><span class="line">    # 验证加密算法</span><br><span class="line">    input_high = enc_2(input_high)</span><br><span class="line">    assert input_high.to_bytes(4, &#x27;big&#x27;) == b&#x27;\xaa\x17\xd8\x10&#x27;</span><br><span class="line">    input_low = enc_2(input_low)</span><br><span class="line">    assert input_low.to_bytes(4, &#x27;big&#x27;) == b&#x27;\xf4\xc0\x8e\x36&#x27;</span><br><span class="line"> </span><br><span class="line">    # 验证解密算法</span><br><span class="line">    input_high = dec_2(input_high)</span><br><span class="line">    input_low = dec_2(input_low)</span><br><span class="line">    input = struct.pack(&#x27;&gt;2I&#x27;, input_low, input_high)</span><br><span class="line">    assert input == b&#x27;\xe3\xd5\x39\x39\xcc\xca\x94\x6d&#x27;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">mytest_2()</span><br><span class="line"></span><br><span class="line"># print(int.from_bytes(b&#x27;\xe3\xd5\x39\x39\xcc\xca\x94\x6d&#x27;,&#x27;little&#x27;))</span><br><span class="line"># print(int.from_bytes(b&#x27;\xe3\xd5\x39\x39\xcc\xca\x94\x6d&#x27;,&#x27;big&#x27;))</span><br><span class="line"># data = b&#x27;\x6d\x94\xca\xcc\x39\x39\xd5\xe3&#x27;</span><br><span class="line"># input_high,input_low = struct.unpack(&#x27;&lt;2I&#x27;,data)</span><br><span class="line"># print(hex(input_high),hex(input_low))</span><br></pre></td></tr></table></figure>

<p>总体看 sub_3B8CC 看传入的参数和返回的数值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function sub_3B8CC()&#123;</span><br><span class="line">    var module = Process.getModuleByName(&quot;libsec2023.so&quot;)</span><br><span class="line">    var func_addr = module.base.add(0x3b8cc)</span><br><span class="line">    Interceptor.attach(func_addr,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            console.log(&quot;参数是：&quot;,args[0])</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line">            console.log(&quot;返回值是：&quot;,retval)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;    </span><br><span class="line">sub_3B8CC()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201174507489.png"></p>
<p>第二次加密后得到的值为：0x10d817aa 368ec0f4</p>
<p>正好对应将高低位反转</p>
<h2 id="vm指令加密："><a href="#vm指令加密：" class="headerlink" title="vm指令加密："></a>vm指令加密：</h2><p>返回 sub_31164 函数，可知经过 sub_3B8CC两个加密后，经过br又发生了跳转</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201174812690.png"></p>
<p>试着在 stalker 中搜一下</p>
<p>可以看到如下跳转</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201175108211.png"></p>
<p>那就回到 libil2cpp.so 的 0x13b8d64 偏移处</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201175442466.png"></p>
<p>经过一个 B 的跳转来到 loc_465AB4，可知该段是 .init_proc 函数 chunk</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201175633748.png"></p>
<p>修改一下函数的结尾：</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251201180202339.png"></p>
<p>然后就可以继续分析了</p>
<p>libsec.so 中的 br x2 跳转到这里，可以继续分析</p>
<p>在 c# 中,自己写的普通类，需要用实例变量&#x2F;方法的需要new(初始化)</p>
<p>c#中一个类的构造函数是 public MyCmlass（）{}，编译到 IL（中间语言）后，构造名称变成 MyClass::.ctor(),再通过 IL2CPP -&gt; c++ -&gt; so，其中的.ctor 会被转成 MyClass_ctor</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101338367.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101650480.png"></p>
<p>可以看到类名和字段都被混淆</p>
<p>搜索一下该类名</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101750751.png"></p>
<p>点开几个方法，发现都有MBA表达式</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202101850613.png"></p>
<p>使用工具 <a target="_blank" rel="noopener" href="https://github.com/DenuvoSoftwareSolutions/GAMBA">GAMBA</a> 简化一下</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202102456799.png"></p>
<p>简化后为 v6 + v8，重命名函数名为 add</p>
<p>以此类推</p>
<p>因为4294967296&#x3D;0x100000000 已经溢出32位了,所以 4294967296+v8&#x3D;v8</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202103101853.png"></p>
<p>简化后：</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202103538149.png"></p>
<p>这个加密算法应该和VM指令有关</p>
<p>返回x2 寄存器跳转处，往下就调用了改类</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202103832200.png"></p>
<p>该类中出现了经典的 while(1) 循环，那其中必定有 opcode 和 eip, 只是名称被混淆了</p>
<p>但是eip 常常作为数组下标出现，因此可以区分出 eip和 opcode</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202111205338.png"></p>
<p>重新命名</p>
<p>this-&gt;fields.OoOOO00; &#x2F;&#x2F; opcode</p>
<p>this-&gt;fields.oOOO0Oo0; &#x2F;&#x2F; eip</p>
<p>再继续分析其他全局变量：</p>
<p>由于 oooO0oOo 的初始值为 -1,所以 oooO0oOo 为堆栈，而不是数组，esp指向栈顶</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202145624848.png"></p>
<p>这里 OOoOO0 入栈了，故 OOoOO0  为输入值</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202145742721.png"></p>
<p>分析下来全局变量如下：</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202145947557.png"></p>
<p>到这里vm 关键变量已经分析的差不多了，点进 add 函数的第一个参数，结构体嵌套结构体</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202150436821.png"></p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202150455796.png"></p>
<p>并且已经知道 vm 指令中加减乘除位运算的位置和输入输出是多少，就可以写脚本hook相关vm指令了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">function hook_vm()&#123;</span><br><span class="line">    //先找到该so文件</span><br><span class="line">    var moudle = Process.getModuleByName(&quot;libil2cpp.so&quot;);</span><br><span class="line">    var my_base = 0x7e78baa000;</span><br><span class="line">    var esp,eip,opcode,input,stack,ptr_esp,ptr_eip</span><br><span class="line">    </span><br><span class="line">    //加载vm指令处，开始处就是while(1)循环处</span><br><span class="line">    var addr_begin = moudle.base.add(0x7E79014D44-my_base)</span><br><span class="line">    Interceptor.attach(addr_begin,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            opcode = ptr(args[0].add(0x10).readS64()).add(0x1C)</span><br><span class="line">            input = ptr(args[0].add(0x18).readS64()).add(0x1C)</span><br><span class="line">            stack = ptr(args[0].add(0x20).readS64()).add(0x1C)</span><br><span class="line">            ptr_esp = args[0].add(0x28)</span><br><span class="line">            ptr_eip = args[0].add(0x2C)</span><br><span class="line">            console.log(&quot;========start========&quot;)</span><br><span class="line">            for(var i =1;i&lt;8;i++)&#123;</span><br><span class="line">                console.log(&quot;input[&quot;+i+&quot;]=0x&quot;+input.add(4*i).readS32().toString(16))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line">            console.log(&quot;=========end=========&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    var addr_add = moudle.base.add(0x7E79014E50-my_base)</span><br><span class="line">    Interceptor.attach(addr_add,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            esp = ptr_esp.readS32()</span><br><span class="line">            eip = ptr_eip.readS32()</span><br><span class="line">            //乘4是因为每个元素占4字节，取出esp和esp+1偏移处的内容</span><br><span class="line">            console.log(&quot;stack[&quot;+esp+&quot;]=0x&quot;+stack.add(4*esp).readS32().toString(16)+</span><br><span class="line">            &quot;+&quot;+stack.add(4*(esp+1)).readS32());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    var addr_sub = moudle.base.add(0x7E79014ECC-my_base)</span><br><span class="line">    Interceptor.attach(addr_sub,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            esp = ptr_esp.readS32()</span><br><span class="line">            eip = ptr_eip.readS32()</span><br><span class="line">            //乘4是因为每个元素占4字节，取出esp和esp+1偏移处的内容</span><br><span class="line">            console.log(&quot;stack[&quot;+esp+&quot;]=0x&quot;+stack.add(4*esp).readS32().toString(16)+</span><br><span class="line">            &quot;-&quot;+stack.add(4*(esp+1)).readS32());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    var addr_mul = moudle.base.add(0x7E79014F44-my_base)</span><br><span class="line">    Interceptor.attach(addr_mul,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            esp = ptr_esp.readS32()</span><br><span class="line">            eip = ptr_eip.readS32()</span><br><span class="line">            //乘4是因为每个元素占4字节，取出esp和esp+1偏移处的内容</span><br><span class="line">            console.log(&quot;stack[&quot;+esp+&quot;]=0x&quot;+stack.add(4*esp).readS32().toString(16)+</span><br><span class="line">            &quot;*&quot;+stack.add(4*(esp+1)).readS32());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    var addr_Lshift = moudle.base.add(0x7E79014FC4-my_base)</span><br><span class="line">    Interceptor.attach(addr_Lshift,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            esp = ptr_esp.readS32()</span><br><span class="line">            eip = ptr_eip.readS32()</span><br><span class="line">            //乘4是因为每个元素占4字节，取出esp和esp+1偏移处的内容</span><br><span class="line">            console.log(&quot;stack[&quot;+esp+&quot;]=0x&quot;+stack.add(4*esp).readS32().toString(16)+</span><br><span class="line">            &quot;&lt;&lt;&quot;+stack.add(4*(esp+1)).readS32());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    var addr_Rshift = moudle.base.add(0x7E79015040-my_base)</span><br><span class="line">    Interceptor.attach(addr_Rshift,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            esp = ptr_esp.readS32()</span><br><span class="line">            eip = ptr_eip.readS32()</span><br><span class="line">            //乘4是因为每个元素占4字节，取出esp和esp+1偏移处的内容</span><br><span class="line">            console.log(&quot;stack[&quot;+esp+&quot;]=0x&quot;+stack.add(4*esp).readS32().toString(16)+</span><br><span class="line">            &quot;&gt;&gt;&quot;+stack.add(4*(esp+1)).readS32());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;)</span><br><span class="line">    var addr_and = moudle.base.add(0x7E790150BC-my_base)</span><br><span class="line">    Interceptor.attach(addr_and,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            esp = ptr_esp.readS32()</span><br><span class="line">            eip = ptr_eip.readS32()</span><br><span class="line">            //乘4是因为每个元素占4字节，取出esp和esp+1偏移处的内容</span><br><span class="line">            console.log(&quot;stack[&quot;+esp+&quot;]=0x&quot;+stack.add(4*esp).readS32().toString(16)+</span><br><span class="line">            &quot;&amp;&quot;+stack.add(4*(esp+1)).readS32());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;)</span><br><span class="line">    var addr_xor = moudle.base.add(0x7E7901513C-my_base)</span><br><span class="line">    Interceptor.attach(addr_xor,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            esp = ptr_esp.readS32()</span><br><span class="line">            eip = ptr_eip.readS32()</span><br><span class="line">            //乘4是因为每个元素占4字节，取出esp和esp+1偏移处的内容</span><br><span class="line">            console.log(&quot;stack[&quot;+esp+&quot;]=0x&quot;+stack.add(4*esp).readS32().toString(16)+</span><br><span class="line">            &quot;^&quot;+stack.add(4*(esp+1)).readS32());</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">          </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hook_vm();</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">========start========</span><br><span class="line">input[1]=0x10d817aa      //输入值的低32位</span><br><span class="line">input[2]=0x368ec0f4      //输入值的高32位</span><br><span class="line"></span><br><span class="line">stack[1]=0x10d817aa&gt;&gt;24  </span><br><span class="line">stack[1]=0x10&amp;255   //取出第4个字节 记为byte4 = 0x10</span><br><span class="line">stack[2]=0x18-8     </span><br><span class="line">stack[2]=0x10d817aa&gt;&gt;16</span><br><span class="line">stack[2]=0x10d8&amp;255  //取出第3个字节 记为byte3 = 0xd8</span><br><span class="line">stack[3]=0x10-8</span><br><span class="line">stack[3]=0x10d817aa&gt;&gt;8  //取出第2个字节 记为byte2 = 0x17</span><br><span class="line">stack[3]=0x10d817&amp;255</span><br><span class="line">stack[4]=0x8-8</span><br><span class="line">stack[4]=0x10d817aa&gt;&gt;0</span><br><span class="line">stack[4]=0x10d817aa&amp;255  //取出第1个字节 记为byte1 = 0xaa</span><br><span class="line">stack[5]=0x0-8</span><br><span class="line">stack[4]=0xaa-27   // byte1 = byte1 -27(0x1B)=0x8f</span><br><span class="line">stack[3]=0x17^194  // byte2 = byte2 ^ 194(0xC2) = 0xD5</span><br><span class="line">stack[2]=0xd8+168  // byte3 = byte3 + 168(0xA8) = 0x180</span><br><span class="line">stack[1]=0x10^54   // byte4 = byte4 ^ 54(0x36) = 0x26</span><br><span class="line">stack[1]=0x8f^0   // byte1 ^ 0</span><br><span class="line">stack[1]=0x8f&lt;&lt;0  //byte1 &lt;&lt; 0</span><br><span class="line">stack[2]=0xff&lt;&lt;0</span><br><span class="line">stack[1]=0x8f&amp;255</span><br><span class="line">stack[1]=0x8f+0</span><br><span class="line">stack[1]=0x4+1</span><br><span class="line">stack[1]=0x0+8</span><br><span class="line">stack[1]=0xd5^8  //byte2 = byte2^8 = 0xDD</span><br><span class="line">stack[1]=0xdd&lt;&lt;8  //byte2 &lt;&lt; 8 = 0xDD00</span><br><span class="line">stack[2]=0xff&lt;&lt;8</span><br><span class="line">stack[1]=0xdd00&amp;65280  //byte2 = byte2 &amp; 65280 = 0xdd00</span><br><span class="line">stack[1]=0xdd00+143    //byte2 = byte2 + 143 = 0x8F</span><br><span class="line">stack[1]=0x5+1</span><br><span class="line">stack[1]=0x8+8</span><br><span class="line">stack[1]=0x180^16  //byte3 = byte3 ^ 16 = 0x190</span><br><span class="line">stack[1]=0x190&lt;&lt;16 //byte3 = byte3 &lt;&lt; 16 = 0xBE000</span><br><span class="line">stack[2]=0xff&lt;&lt;16</span><br><span class="line">stack[1]=0x1900000&amp;16711680</span><br><span class="line">stack[1]=0x900000+56719</span><br><span class="line">stack[1]=0x6+1</span><br><span class="line">stack[1]=0x10+8</span><br><span class="line">stack[1]=0x26^24  //byte4 = byte4 ^ 24 = 0x3e</span><br><span class="line">stack[1]=0x3e&lt;&lt;24  //byte4 = byte4 &lt;&lt; 24 = 0x3E000000</span><br><span class="line">stack[2]=0xff&lt;&lt;24</span><br><span class="line">stack[1]=0x3e000000&amp;-16777216</span><br><span class="line">stack[1]=0x3e000000+9493903 //byte4 = byte4 + 9492903 = 0x3E90DD8F</span><br><span class="line"></span><br><span class="line">//高32位加密</span><br><span class="line">stack[1]=0x7+1</span><br><span class="line">stack[1]=0x18+8</span><br><span class="line">stack[1]=0x368ec0f4&gt;&gt;24  //byte4 = 0x36</span><br><span class="line">stack[1]=0x36&amp;255</span><br><span class="line">stack[2]=0x18-8</span><br><span class="line">stack[2]=0x368ec0f4&gt;&gt;16 //byte3 = 0x8e</span><br><span class="line">stack[2]=0x368e&amp;255</span><br><span class="line">stack[3]=0x10-8</span><br><span class="line">stack[3]=0x368ec0f4&gt;&gt;8  //byte2 = 0xc0</span><br><span class="line">stack[3]=0x368ec0&amp;255</span><br><span class="line">stack[4]=0x8-8</span><br><span class="line">stack[4]=0x368ec0f4&gt;&gt;0  //byte1 = 0xf4</span><br><span class="line">stack[4]=0x368ec0f4&amp;255</span><br><span class="line">stack[5]=0x0-8</span><br><span class="line">stack[4]=0xf4-47  //byte1 = byte1 - 47 = 0xc5</span><br><span class="line">stack[3]=0xc0^182  //byte2 = byte2 ^ 182 = 0x76</span><br><span class="line">stack[2]=0x8e+55   //byte3 = byte3 + 55 = 0xc5</span><br><span class="line">stack[1]=0x36^152  //byte4 = byte4 ^ 152 = 0xAE</span><br><span class="line">stack[1]=0xc5+0    //byte1 +0</span><br><span class="line">stack[1]=0xc5&lt;&lt;0   // byte1 &lt;&lt;0</span><br><span class="line">stack[2]=0xff&lt;&lt;0</span><br><span class="line">stack[1]=0xc5&amp;255</span><br><span class="line">stack[1]=0xc5+0</span><br><span class="line">stack[1]=0x4+1</span><br><span class="line">stack[1]=0x0+8</span><br><span class="line">stack[1]=0x76+8        //byte2 = byte2+8 = 0x7E</span><br><span class="line">stack[1]=0x7e&lt;&lt;8       //byte2 = byte2 &lt;&lt; 8 = 0x7E00</span><br><span class="line">stack[2]=0xff&lt;&lt;8</span><br><span class="line">stack[1]=0x7e00&amp;65280  </span><br><span class="line">stack[1]=0x7e00+197    //byte2 = byte2 +197 = 0x7EC5</span><br><span class="line">stack[1]=0x5+1</span><br><span class="line">stack[1]=0x8+8</span><br><span class="line">stack[1]=0xc5+16    //byte3 +16</span><br><span class="line">stack[1]=0xd5&lt;&lt;16   //byte3 &lt;&lt;16</span><br><span class="line">stack[2]=0xff&lt;&lt;16</span><br><span class="line">stack[1]=0xd50000&amp;16711680</span><br><span class="line">stack[1]=0xd50000+32453</span><br><span class="line">stack[1]=0x6+1</span><br><span class="line">stack[1]=0x10+8</span><br><span class="line">stack[1]=0xae+24   //byte4 +24</span><br><span class="line">stack[1]=0xc6&lt;&lt;24  //byte4 &lt;&lt;24</span><br><span class="line">stack[2]=0xff&lt;&lt;24</span><br><span class="line">stack[1]=0x-3a000000&amp;-16777216</span><br><span class="line">stack[1]=0x-3a000000+13991621</span><br><span class="line">stack[1]=0x7+1</span><br><span class="line">stack[1]=0x18+8</span><br><span class="line">=========end=========</span><br></pre></td></tr></table></figure>

<p>逻辑很清晰，写解密脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line"></span><br><span class="line">def enc_vm_low(input):</span><br><span class="line">    # 按照大端序解包4个字节</span><br><span class="line">    byte4,byte3,byte2,byte1 = struct.unpack(&quot;&gt;4B&quot;,input.to_bytes(4,&#x27;big&#x27;))</span><br><span class="line">    # 0x10d817aa 从左到右分别是byte4,byte3,byte2,byte1</span><br><span class="line">    byte1 = (byte1 - 27) ^ 0</span><br><span class="line">    byte2 = (byte2 ^ 194) ^ 8</span><br><span class="line">    byte3 = (byte3 + 168) ^ 16</span><br><span class="line">    byte4 =  (byte4 ^ 54) ^ 24</span><br><span class="line">    # print(&quot;byte4:&quot;+hex(byte4)+&quot; byte3:&quot;+hex(byte3)+&quot; byte2:&quot;+hex(byte2)+&quot; byte1:&quot;+hex(byte1))</span><br><span class="line">    #小端序列打包4个字节</span><br><span class="line">    input = struct.pack(&quot;&lt;4B&quot;,byte1 &amp; 0xff,byte2 &amp; 0xff,byte3 &amp; 0xff,byte4 &amp; 0xff)</span><br><span class="line">    return int.from_bytes(input,&#x27;little&#x27;)</span><br><span class="line"></span><br><span class="line">#print(hex(enc_vm_low(int.from_bytes(b&#x27;\x10\xd8\x17\xaa&#x27;,&#x27;big&#x27;))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dec_vm_low(input):</span><br><span class="line">    # 按照大端序解包4个字节</span><br><span class="line">    byte4,byte3,byte2,byte1 = struct.unpack(&quot;&gt;4B&quot;,input.to_bytes(4,&#x27;big&#x27;))</span><br><span class="line">    byte1 = (byte1  ^ 0) + 27</span><br><span class="line">    byte2 = (byte2  ^ 8)^ 194</span><br><span class="line">    byte3 = (byte3  ^ 16)- 168</span><br><span class="line">    byte4 =  (byte4 ^ 24)^ 54</span><br><span class="line">    input = struct.pack(&quot;&lt;4B&quot;,byte1 &amp; 0xff,byte2 &amp; 0xff,byte3 &amp; 0xff,byte4 &amp; 0xff)</span><br><span class="line">    return int.from_bytes(input,&quot;little&quot;)</span><br><span class="line"></span><br><span class="line">def enc_vm_high(input):</span><br><span class="line">    # 按照大端序解包4个字节</span><br><span class="line">    byte4,byte3,byte2,byte1 = struct.unpack(&quot;&gt;4B&quot;,input.to_bytes(4,&#x27;big&#x27;))</span><br><span class="line">    byte1 = (byte1  -47) + 0</span><br><span class="line">    byte2 = (byte2  ^ 182) + 8</span><br><span class="line">    byte3 = (byte3 + 55) + 16</span><br><span class="line">    byte4 =  (byte4 ^ 152) + 24</span><br><span class="line">    input = struct.pack(&quot;&lt;4B&quot;,byte1 &amp; 0xff,byte2 &amp; 0xff,byte3 &amp; 0xff,byte4 &amp; 0xff)</span><br><span class="line">    return int.from_bytes(input,&quot;little&quot;)</span><br><span class="line"></span><br><span class="line">def dec_vm_high(input):</span><br><span class="line">    # 按照大端序解包4个字节</span><br><span class="line">    byte4,byte3,byte2,byte1 = struct.unpack(&quot;&gt;4B&quot;,input.to_bytes(4,&#x27;big&#x27;))</span><br><span class="line">    byte1 = (byte1  -0) + 47</span><br><span class="line">    byte2 = (byte2  -8) ^ 182</span><br><span class="line">    byte3 = (byte3 -16 ) - 55</span><br><span class="line">    byte4 =  (byte4 -24) ^ 152</span><br><span class="line">    input = struct.pack(&quot;&lt;4B&quot;,byte1 &amp; 0xff,byte2 &amp; 0xff,byte3 &amp; 0xff,byte4 &amp; 0xff)</span><br><span class="line">    return int.from_bytes(input,&quot;little&quot;)</span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">    # 由第二个加密点传过来的值为：0x368ec0f4 10d817aa</span><br><span class="line">    input_high = int.from_bytes(b&#x27;\x36\x8e\xc0\xf4&#x27;,&#x27;big&#x27;)</span><br><span class="line">    input_low = int.from_bytes(b&#x27;\x10\xd8\x17\xaa&#x27;,&#x27;big&#x27;)</span><br><span class="line">    </span><br><span class="line">    input_low = enc_vm_low(input_low)</span><br><span class="line">    input_high = enc_vm_high(input_high)</span><br><span class="line">    print(&quot;input_low:0x10d817aa 加密后：&quot;+hex(input_low))</span><br><span class="line">    print(&quot;input_high:0x368ec0f4 加密后：&quot;+hex(input_high))</span><br><span class="line"></span><br><span class="line">    #验证解密算法</span><br><span class="line">    input_low = dec_vm_low(input_low)</span><br><span class="line">    input_high = dec_vm_high(input_high)</span><br><span class="line">    print(&quot;0x3e90dd8f 解密后：&quot;+hex(input_low))</span><br><span class="line">    print(&quot;0xc6d57ec5 解密后：&quot;+hex(input_high))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202151134650.png"></p>
<p>进行加密的数值正好对应第二次加密后得到的数值</p>
<p>第三处加密就结束了</p>
<h2 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h2><p>回到 libsec.so br x2跳转来到的函数继续往下分析</p>
<p>很明显的 <a target="_blank" rel="noopener" href="https://share.note.youdao.com/s/azFycxxu">XTEA加密</a></p>
<p>逻辑比较清晰，只是密钥未知</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202151421016.png"></p>
<p>使用frida 将 密钥v36 hook下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function hook_x20()&#123;</span><br><span class="line">    var module = Process.getModuleByName(&quot;libil2cpp.so&quot;)</span><br><span class="line">    var my_base = 0x7e78baa000</span><br><span class="line">    var addr = module.base.add(0x7E7900FC60 - my_base)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(addr,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            console.log(hexdump(this.context.x20,&#123;</span><br><span class="line">                offset: 0,</span><br><span class="line">                length: 64,</span><br><span class="line">                header: true,</span><br><span class="line">                ansi: true</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">hook_x20()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202152037447.png"></p>
<p>并且把加密后的值 hook下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function hook_xtea()&#123;</span><br><span class="line">    var module = Process.getModuleByName(&quot;libil2cpp.so&quot;)</span><br><span class="line">    var my_base = 0x7e78baa000</span><br><span class="line">    var addr = module.base.add(0x7E7900FD14 - my_base)</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(addr,&#123;</span><br><span class="line">        onEnter(args)&#123;</span><br><span class="line">            console.log(&quot;result_low:&quot;,this.context.x21);</span><br><span class="line">            console.log(&quot;result_high:&quot;,this.context.x22);</span><br><span class="line">            console.log(&quot;result:&quot;,this.context.x0);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave(retval)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">hook_xtea()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202152319783.png"></p>
<p>写 xtea 的解密脚本:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import ctypes</span><br><span class="line"></span><br><span class="line">def enc_xtea(input_low,input_high):</span><br><span class="line">    # tea系列的每个值都必须是32位无符号整数</span><br><span class="line">    v0,v1 = ctypes.c_uint32(input_low),ctypes.c_uint32(input_high)</span><br><span class="line">    # ctypes.c_uint32 不是普通数字，它是一个结构体对象，它内部有个 .value 才是真正的 32-bit 整数。</span><br><span class="line">    key = [0x7b777c63,0xc56f6bf2,0x2b670130,0x76abd7fe]</span><br><span class="line">    delta = 0x21524111</span><br><span class="line">    total1 = ctypes.c_uint32(0xBEEFBEEF)  </span><br><span class="line">    total2 = ctypes.c_uint32(0x9D9D7DDE)</span><br><span class="line">    for i in range(64):</span><br><span class="line">        v0.value += (((v1.value &lt;&lt; 7) ^ (v1.value &gt;&gt; 8)) + v1.value) ^ (total1.value - key[total1.value &amp; 3])</span><br><span class="line">        total1.value -= delta</span><br><span class="line">        v1.value += (((v0.value &lt;&lt; 8) ^ (v0.value &gt;&gt; 7)) - v0.value) ^ (total2.value + key[(total2.value &gt;&gt; 13) &amp; 3])</span><br><span class="line">        total2.value -= delta</span><br><span class="line">    return v0.value ,v1.value</span><br><span class="line"></span><br><span class="line">def dec_xtea(input_low,input_high):</span><br><span class="line">    v0,v1 = ctypes.c_uint32(input_low),ctypes.c_uint32(input_high)</span><br><span class="line">    key = [0x7b777c63,0xc56f6bf2,0x2b670130,0x76abd7fe]</span><br><span class="line">    delta = 0x21524111</span><br><span class="line">    total1 = ctypes.c_uint32(0xBEEFBEEF - 64 * delta)  </span><br><span class="line">    total2 = ctypes.c_uint32(0x9D9D7DDE - 64 * delta)</span><br><span class="line">    for i in range(64):</span><br><span class="line">        total2.value += delta</span><br><span class="line">        v1.value -= (((v0.value &lt;&lt; 8) ^ (v0.value &gt;&gt; 7)) - v0.value) ^ (total2.value + key[(total2.value &gt;&gt; 13) &amp; 3])</span><br><span class="line">        total1.value += delta</span><br><span class="line">        v0.value -= (((v1.value &lt;&lt; 7) ^ (v1.value &gt;&gt; 8)) + v1.value) ^ (total1.value - key[total1.value &amp; 3]) </span><br><span class="line">    return v0.value ,v1.value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">    input_low = 0x3e90dd8f</span><br><span class="line">    input_high = 0xc6d57ec5</span><br><span class="line"></span><br><span class="line">    #验证解密算法</span><br><span class="line">    input_low,input_high = enc_xtea(input_low,input_high) </span><br><span class="line">    assert(input_low,input_high) == (0xabba3c01,0x7223607f)</span><br><span class="line"></span><br><span class="line">    #验证加密算法</span><br><span class="line">    input_low,input_high = dec_xtea(input_low,input_high)</span><br><span class="line">    assert(input_low,input_high) == (0x3e90dd8f,0xc6d57ec5)</span><br><span class="line"></span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<p>至此四处加密都分析完了</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251202152546122.png"></p>
<h1 id="注册机"><a href="#注册机" class="headerlink" title="注册机"></a>注册机</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line">import ctypes</span><br><span class="line">algorithm_1=&#123;</span><br><span class="line">    (0,&quot;enc&quot;) :lambda x: (x-28) &amp; 0xff,  # 防止溢出或负数, 确保结果在 0~255 之间</span><br><span class="line">    (1,&quot;enc&quot;) :lambda x: (x^0xD3), </span><br><span class="line">    (2,&quot;enc&quot;) :lambda x: (x-94) &amp; 0xff,</span><br><span class="line">    (3,&quot;enc&quot;) :lambda x: (x^0x86),</span><br><span class="line"></span><br><span class="line">    (0,&quot;dec&quot;) :lambda x: (x+28)  &amp; 0xff,</span><br><span class="line">    (1,&quot;dec&quot;) :lambda x: (x^0xD3),</span><br><span class="line">    (2,&quot;dec&quot;) :lambda x: (x+94) &amp; 0xff,</span><br><span class="line">    (3,&quot;dec&quot;) :lambda x: (x^0x86)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 加密点4，xtea</span><br><span class="line">def dec_xtea(input_low,input_high):</span><br><span class="line">    v0,v1 = ctypes.c_uint32(input_low),ctypes.c_uint32(input_high)</span><br><span class="line">    key = [0x7b777c63,0xc56f6bf2,0x2b670130,0x76abd7fe]</span><br><span class="line">    delta = 0x21524111</span><br><span class="line">    total1 = ctypes.c_uint32(0xBEEFBEEF - 64 * delta)  </span><br><span class="line">    total2 = ctypes.c_uint32(0x9D9D7DDE - 64 * delta)</span><br><span class="line">    for i in range(64):</span><br><span class="line">        total2.value += delta</span><br><span class="line">        v1.value -= (((v0.value &lt;&lt; 8) ^ (v0.value &gt;&gt; 7)) - v0.value) ^ (total2.value + key[(total2.value &gt;&gt; 13) &amp; 3])</span><br><span class="line">        total1.value += delta</span><br><span class="line">        v0.value -= (((v1.value &lt;&lt; 7) ^ (v1.value &gt;&gt; 8)) + v1.value) ^ (total1.value - key[total1.value &amp; 3]) </span><br><span class="line">    return v0.value ,v1.value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 加密点3，vm</span><br><span class="line">def dec_vm_low(input):</span><br><span class="line">    # 按照大端序解包4个字节</span><br><span class="line">    byte4,byte3,byte2,byte1 = struct.unpack(&quot;&gt;4B&quot;,input.to_bytes(4,&#x27;big&#x27;))</span><br><span class="line">    byte1 = (byte1  ^ 0) + 27</span><br><span class="line">    byte2 = (byte2  ^ 8)^ 194</span><br><span class="line">    byte3 = (byte3  ^ 16)- 168</span><br><span class="line">    byte4 =  (byte4 ^ 24)^ 54</span><br><span class="line">    input = struct.pack(&quot;&lt;4B&quot;,byte1 &amp; 0xff,byte2 &amp; 0xff,byte3 &amp; 0xff,byte4 &amp; 0xff)</span><br><span class="line">    return int.from_bytes(input,&quot;little&quot;)</span><br><span class="line"></span><br><span class="line">def dec_vm_high(input):</span><br><span class="line">    # 按照大端序解包4个字节</span><br><span class="line">    byte4,byte3,byte2,byte1 = struct.unpack(&quot;&gt;4B&quot;,input.to_bytes(4,&#x27;big&#x27;))</span><br><span class="line">    byte1 = (byte1  -0) + 47</span><br><span class="line">    byte2 = (byte2  -8) ^ 182</span><br><span class="line">    byte3 = (byte3 -16 ) - 55</span><br><span class="line">    byte4 =  (byte4 -24) ^ 152</span><br><span class="line">    input = struct.pack(&quot;&lt;4B&quot;,byte1 &amp; 0xff,byte2 &amp; 0xff,byte3 &amp; 0xff,byte4 &amp; 0xff)</span><br><span class="line">    return int.from_bytes(input,&quot;little&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 加密点2  blackObfuscator</span><br><span class="line">def dec_2(input):</span><br><span class="line">    input_byte = bytearray(input.to_bytes(4, &#x27;big&#x27;))</span><br><span class="line">    xor_arr = [50, -51, -1, -104, 25, -78, 0x7C, -102]</span><br><span class="line">    for i in range(4):</span><br><span class="line">        input_byte[i] = (input_byte[i] - i) &amp; 0xff</span><br><span class="line">        input_byte[i] = (input_byte[i] ^ xor_arr[i]) &amp; 0xff</span><br><span class="line"> </span><br><span class="line">    input = int.from_bytes(input_byte, &#x27;big&#x27;)</span><br><span class="line">    input = (input &lt;&lt; 7 | input &gt;&gt; 25) &amp; 0xffffffff</span><br><span class="line">    input = int.from_bytes(input.to_bytes(4, &#x27;little&#x27;), &#x27;big&#x27;)  # 字节再次翻转</span><br><span class="line"> </span><br><span class="line">    return input</span><br><span class="line"></span><br><span class="line">#加密点1 花指令</span><br><span class="line">def dec_1(input):</span><br><span class="line">    input_bytes = bytearray(input.to_bytes(8,&#x27;little&#x27;))</span><br><span class="line">    dec_array = [0] * len(input_bytes)</span><br><span class="line">    for i in range(len(input_bytes)):</span><br><span class="line">        index = i % 4</span><br><span class="line">        dec_array[i] = (algorithm_1[(index,&quot;dec&quot;)]((input_bytes[i] + 8*index)&amp;0xff) ^ index) </span><br><span class="line">    return int.from_bytes(bytearray(dec_array),&#x27;little&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">token = int(input(&quot;enter the token plz~:&quot;))</span><br><span class="line">input_low,input_high = token,0</span><br><span class="line"></span><br><span class="line"># xtea</span><br><span class="line">input_low,input_high = dec_xtea(input_low,input_high)</span><br><span class="line"></span><br><span class="line">#vm</span><br><span class="line">input_low,input_high = dec_vm_low(input_low),dec_vm_high(input_high)</span><br><span class="line"></span><br><span class="line"># bswap32 ,字节序列完全反转</span><br><span class="line"># 把 input_low 和 input_high 以“小端格式”写进字节数组， 返回一个 8 字节的 bytes 对象，字节数组</span><br><span class="line">input = struct.pack(&quot;&lt;2I&quot;,input_low,input_high)</span><br><span class="line"># 把 8 字节（bytes）重新“读出”为两个 32bit 整数</span><br><span class="line">input_low,input_high = struct.unpack(&quot;&gt;2I&quot;,input)</span><br><span class="line"></span><br><span class="line"># 高低位相互转换</span><br><span class="line">input_low,input_high = input_high,input_low</span><br><span class="line"></span><br><span class="line"># blackObfuscator</span><br><span class="line">input_low = dec_2(input_low)</span><br><span class="line">input_high = dec_2(input_high)</span><br><span class="line"></span><br><span class="line"># 花指令</span><br><span class="line">input= struct.pack(&#x27;&gt;2I&#x27;,input_low,input_high)</span><br><span class="line">input=int.from_bytes(input,&#x27;little&#x27;)</span><br><span class="line">input = dec_1(input)</span><br><span class="line"></span><br><span class="line">print(input)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>输入token后，即可生成激活外挂的密钥</p>
<p><img src="https://raw.githubusercontent.com/yagyiqing/ImageHosting/master/20251118180851776.png"></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/09/16/uni-app-Express/" rel="prev" title="uni-app＋Express(v0.1)">
      <i class="fa fa-chevron-left"></i> uni-app＋Express(v0.1)
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%EF%BC%9A"><span class="nav-number">1.</span> <span class="nav-text">环境：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%EF%BC%9A"><span class="nav-number">2.</span> <span class="nav-text">工具：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E9%80%86%E6%80%9D%E8%B7%AF"><span class="nav-number">3.</span> <span class="nav-text">开始逆思路:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dump-%E8%A7%A3%E5%AF%86%E7%8A%B6%E6%80%81%E7%9A%84-libil2cpp-so-%E6%96%87%E4%BB%B6"><span class="nav-number">3.1.</span> <span class="nav-text">dump 解密状态的 libil2cpp.so 文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E5%A4%8D-dump-%E4%B8%8B%E6%9D%A5%E7%9A%84-so-%E6%96%87%E4%BB%B6"><span class="nav-number">3.2.</span> <span class="nav-text">修复 dump 下来的 so 文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%AD%A3%E6%AE%B5%EF%BC%88Segment%EF%BC%89%E7%9A%84%E5%81%8F%E7%A7%BB%EF%BC%9A"><span class="nav-number">3.2.1.</span> <span class="nav-text">修正段（Segment）的偏移：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%AD%A3-%E8%8A%82%E8%A1%A8%E5%A4%B4%E7%9A%84%E5%81%8F%E7%A7%BB"><span class="nav-number">3.2.2.</span> <span class="nav-text">修正 节表头的偏移:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%85%85Section-%E5%A4%B4%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="nav-number">3.2.3.</span> <span class="nav-text">补充Section 头的内容：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%81%A2%E5%A4%8D%E8%8A%82%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%9A"><span class="nav-number">3.2.4.</span> <span class="nav-text">恢复节的名称：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%AD%A3%E8%8A%82%E7%9A%84%E5%81%8F%E7%A7%BB"><span class="nav-number">3.2.5.</span> <span class="nav-text">修正节的偏移</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE-coin-%E6%89%BE%E5%88%87%E5%85%A5%E7%82%B9"><span class="nav-number">3.3.</span> <span class="nav-text">根据 coin 找切入点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%BB%E9%99%A4%E8%8A%B1%E6%8C%87%E4%BB%A4%EF%BC%8C%E6%89%BE%E5%88%B0%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8A%A0%E5%AF%86%E7%82%B9"><span class="nav-number">3.4.</span> <span class="nav-text">去除花指令，找到第一个加密点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8A%A0%E5%AF%86%E7%82%B9"><span class="nav-number">3.5.</span> <span class="nav-text">第二个加密点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vm%E6%8C%87%E4%BB%A4%E5%8A%A0%E5%AF%86%EF%BC%9A"><span class="nav-number">3.6.</span> <span class="nav-text">vm指令加密：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XTEA"><span class="nav-number">3.7.</span> <span class="nav-text">XTEA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E6%9C%BA"><span class="nav-number">4.</span> <span class="nav-text">注册机</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="行走云端"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">行走云端</p>
  <div class="site-description" itemprop="description">学无止境</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2025-02 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">行走云端</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
